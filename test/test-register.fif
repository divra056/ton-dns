"Asm.fif" include
"TonUtil.fif" include

{ 0 -rot runvm } : runvm!

"test-manual-dns.fif" include <s =: code

"test/out/id1.pk" load-keypair =: privkey1 =: pubkey1
"test/out/id2.pk" load-keypair =: privkey2 =: pubkey2 cr

<b
    0 32 u, // seqno
    pubkey1 B, 
    <b b> ref,
b> =: storage

<b
    0 32 u, // seqno
    0 32 u, // method
    <b
        "ru" $, // name
    b> ref,
    <b 
        44 32 u, // category
        pubkey2 B, // dns-value
    b> ref,
b> =: message
message hashB privkey1 ed25519_sign =: signature

<b
    signature B,
    message <s s,
b> <s =: signed-message

."Message #1: ru 42 <pubkey2>" cr
."Signature: " cr signature Bx. cr
."Content: "   cr message <s csr.
."Result: "    cr signed-message csr. cr

."Original storage: " cr storage <s csr. cr

."Checking signature localy: " message hashB signature pubkey1 ed25519_chksign x. cr cr

signed-message code storage runvm! =: storage =: exit_code cr
."Result #1: " cr
."Exit code " exit_code . cr
."Updated storage: " cr storage <s csr. cr
