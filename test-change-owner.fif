"Asm.fif" include
"TonUtil.fif" include

"test-manual-dns.fif" include <s =: code

"out/id1.pk" load-keypair =: privkey1 =: pubkey1
"out/id2.pk" load-keypair =: privkey2 =: pubkey2

<b
    pubkey1 B,
b> =: storage

<b
    1 8 u,
    pubkey2 B,
b> =: message
message hashB privkey1 ed25519_sign =: signature

."Signature: " cr signature Bx. cr
."Signed: " cr message <s csr. cr

<b
    signature B,
    message <s s,
b> <s =: in_msg

."Original storage: " cr storage <s csr. cr
."Original message: " cr in_msg csr. cr

message hashB signature pubkey1 ed25519_chksign x.

in_msg code storage runvm
constant updated_storage
constant exit_code
."Exit code " exit_code . cr
."Updated storage: " cr updated_storage <s csr. cr


in_msg code updated_storage runvm
constant updated_storage2
constant exit_code2
."Exit code " exit_code2 . cr
."Updated storage: " cr updated_storage2 <s csr. cr

<b
    1 8 u,
    pubkey1 B,
b> =: message2
message2 hashu privkey2 ed25519_sign_uint =: signature2
<b
    signature2 B,
    message2 <s s,
b> <s =: in_msg2

."Modified message: " cr in_msg2 csr. cr

in_msg2 code updated_storage2 runvm
constant updated_storage3
constant exit_code3
."Exit code " exit_code3 . cr
."Updated storage: " cr updated_storage3 <s csr. cr
